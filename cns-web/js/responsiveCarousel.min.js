(function(a){a.fn.carousel=function(d){var b,c;b={infinite:true,visible:1,speed:"fast",overflow:false,autoRotate:false,navigation:a(this).data("navigation"),itemMinWidth:0,itemEqualHeight:false,itemMargin:0,itemClassActive:"crsl-active",imageWideClass:"wide-image",carousel:true};return a(this).each(function(){c=a(this);if(a.isEmptyObject(d)===false){a.extend(b,d)}if(a.isEmptyObject(a(c).data("crsl"))===false){a.extend(b,a(c).data("crsl"))}b.isTouch="ontouchstart" in document.documentElement||navigator.userAgent.match(/Android|BlackBerry|iPhone|iPad|iPod|Opera Mini|IEMobile/i)?true:false;c.init=function(){b.total=a(c).find(".crsl-item").length;b.itemWidth=a(c).outerWidth();b.visibleDefault=b.visible;b.swipeDistance=null;b.swipeMinDistance=100;b.startCoords={};b.endCoords={};a(c).css({width:"100%"});a(c).find(".crsl-item").css({position:"relative","float":"left",overflow:"hidden",height:"auto"});a(c).find("."+b.imageWideClass).each(function(){a(this).css({display:"block",width:"100%",height:"auto"})});a(c).find(".crsl-item iframe").attr({width:"100%"});if(b.carousel){a(c).find(".crsl-item:first-child").addClass(b.itemClassActive)}if(b.carousel&&b.infinite&&b.visible<b.total){a(c).find(".crsl-item:first-child").before(a(".crsl-item:last-child",c))}if(b.overflow===false){a(c).css({overflow:"hidden"})}else{a("html, body").css({"overflow-x":"hidden"})}a(c).trigger("initCarousel",[b,c]);c.testPreload();c.config();c.initRotate();c.triggerNavs()};c.testPreload=function(){if(a(c).find("img").length>0){var h=a(c).find("img").length,g=1;a(c).find("img").each(function(){c.preloadImage(this,g,h);g++})}else{a(c).trigger("loadedCarousel",[b,c])}};c.preloadImage=function(k,g,j){var h=new Image,l={};l.src=a(k).attr("src")!==undefined?k.src:"";l.alt=a(k).attr("alt")!==undefined?k.alt:"";a(h).attr(l);a(h).on("load",function(){if(g===1){a(c).trigger("loadingImagesCarousel",[b,c])}if(g===j){a(c).trigger("loadedImagesCarousel",[b,c])}})};c.config=function(){b.itemWidth=Math.floor((a(c).outerWidth()-b.itemMargin*(b.visibleDefault-1))/b.visibleDefault);if(b.itemWidth<=b.itemMinWidth){b.visible=Math.floor((a(c).outerWidth()-b.itemMargin*(b.visible-1))/b.itemMinWidth)===1?Math.floor(a(c).outerWidth()/b.itemMinWidth):Math.floor((a(c).outerWidth()-b.itemMargin)/b.itemMinWidth);b.visible=b.visible<1?1:b.visible;b.itemWidth=b.visible===1?Math.floor(a(c).outerWidth()):Math.floor((a(c).outerWidth()-b.itemMargin*(b.visible-1))/b.visible)}else{b.visible=b.visibleDefault}if(b.carousel){c.wrapWidth=Math.floor((b.itemWidth+b.itemMargin)*b.total);c.wrapMargin=c.wrapMarginDefault=b.infinite&&b.visible<b.total?parseInt((b.itemWidth+b.itemMargin)*-1,10):0;if(b.infinite&&b.visible<b.total&&a(c).find(".crsl-item."+b.itemClassActive).index()===0){a(c).find(".crsl-item:first-child").before(a(".crsl-item:last-child",c));c.wrapMargin=c.wrapMarginDefault=parseInt((b.itemWidth+b.itemMargin)*-1,10)}a(c).find(".crsl-wrap").css({width:c.wrapWidth+"px",marginLeft:c.wrapMargin})}else{c.wrapWidth=a(c).outerWidth();a(c).find(".crsl-wrap").css({width:c.wrapWidth+b.itemMargin+"px"});a("#"+b.navigation).hide()}a(c).find(".crsl-item").css({width:b.itemWidth+"px",marginRight:b.itemMargin+"px"});c.equalHeights();if(b.carousel){if(b.visible>=b.total){b.autoRotate=false;a("#"+b.navigation).hide()}else{a("#"+b.navigation).show()}}};c.equalHeights=function(){if(b.itemEqualHeight!==false){var g=0;a(c).find(".crsl-item").each(function(){a(this).css({height:"300"});if(a(this).outerHeight()>g){g=a(this).outerHeight()}});a(c).find(".crsl-item").css({height:g+"px"})}return true};c.initRotate=function(){if(b.autoRotate!==true){c.rotateTime=window.setInterval(function(){c.rotate()},8000)}};c.triggerNavs=function(){a("#"+b.navigation).delegate(".previous, .next","click",function(g){g.preventDefault();c.prepareExecute();if(a(this).hasClass("previous")&&c.testPrevious(c.itemActive)){c.previous()}else{if(a(this).hasClass("next")&&c.testNext()){c.next()}else{return}}})};c.prepareExecute=function(){if(b.autoRotate){clearInterval(c.rotateTime)}c.preventAnimateEvent();c.itemActive=a(c).find(".crsl-item."+b.itemClassActive);return true};c.preventAnimateEvent=function(){if(a(c).find(".crsl-wrap:animated").length>0){return false}};c.rotate=function(){c.preventAnimateEvent();c.itemActive=a(c).find(".crsl-item."+b.itemClassActive);c.next();return true};c.testPrevious=function(g){return a(".crsl-wrap",c).find(".crsl-item").index(g)>0};c.testNext=function(){return !b.infinite&&c.wrapWidth>=(b.itemWidth+b.itemMargin)*(b.visible+1)-c.wrapMargin||b.infinite};c.previous=function(){c.wrapMargin=b.infinite?c.wrapMarginDefault+a(c.itemActive).outerWidth(true):c.wrapMargin+a(c.itemActive).outerWidth(true);var j=a(c.itemActive).index();var g=a(c.itemActive).prev(".crsl-item");var h="previous";a(c).trigger("beginCarousel",[b,c,h]);a(c).find(".crsl-wrap").animate({marginLeft:c.wrapMargin+"px"},b.speed,function(){a(c.itemActive).removeClass(b.itemClassActive);a(g).addClass(b.itemClassActive);if(b.infinite){a(this).css({marginLeft:c.wrapMarginDefault}).find(".crsl-item:first-child").before(a(".crsl-item:last-child",c))}else{if(c.testPrevious(g)===false){a("#"+b.navigation).find(".previous").addClass("previous-inactive")}if(c.testNext()){a("#"+b.navigation).find(".next").removeClass("next-inactive")}}a(this).trigger("endCarousel",[b,c,h])})};c.next=function(){c.wrapMargin=b.infinite?c.wrapMarginDefault-a(c.itemActive).outerWidth(true):c.wrapMargin-a(c.itemActive).outerWidth(true);var j=a(c.itemActive).index();var g=a(c.itemActive).next(".crsl-item");var h="next";a(c).trigger("beginCarousel",[b,c,h]);a(c).find(".crsl-wrap").animate({marginLeft:c.wrapMargin+"px"},b.speed,function(){a(c.itemActive).removeClass(b.itemClassActive);a(g).addClass(b.itemClassActive);if(b.infinite){a(this).css({marginLeft:c.wrapMarginDefault}).find(".crsl-item:last-child").after(a(".crsl-item:first-child",c))}else{if(c.testPrevious(g)){a("#"+b.navigation).find(".previous").removeClass("previous-inactive")}if(c.testNext()===false){a("#"+b.navigation).find(".next").addClass("next-inactive")}}a(this).trigger("endCarousel",[b,c,h])})};var e=false,f;a(window).on("mouseleave",function(g){if(g.target){f=g.target}else{if(g.srcElement){f=g.srcElement}}if(a(c).attr("id")&&a(f).parents(".crsl-items").attr("id")===a(c).attr("id")||a(f).parents(".crsl-items").data("navigation")===a(c).data("navigation")){e=true}else{e=false}return false});a(window).on("keydown",function(g){if(e===true){if(g.keyCode===37){c.prepareExecute();c.previous()}else{if(g.keyCode===39){c.prepareExecute();c.next()}}}return});if(b.isTouch){a(c).on("touchstart",function(g){a(c).addClass("touching");b.startCoords=g.originalEvent.targetTouches[0];b.endCoords=g.originalEvent.targetTouches[0];a(".touching").on("touchmove",function(h){b.endCoords=h.originalEvent.targetTouches[0];if(Math.abs(parseInt(b.endCoords.pageX-b.startCoords.pageX,10))>Math.abs(parseInt(b.endCoords.pageY-b.startCoords.pageY,10))){h.preventDefault();h.stopPropagation()}})}).on("touchend",function(g){g.preventDefault();g.stopPropagation();b.swipeDistance=b.endCoords.pageX-b.startCoords.pageX;if(b.swipeDistance>=b.swipeMinDistance){c.previous()}else{if(b.swipeDistance<=-b.swipeMinDistance){c.next()}}a(".touching").off("touchmove").removeClass("touching")})}a(c).on("loadedCarousel loadedImagesCarousel",function(){c.equalHeights()});a(window).on("carouselResizeEnd",function(){if(b.itemWidth!==a(c).outerWidth()){c.config()}});a(window).ready(function(){a(c).trigger("prepareCarousel",[b,c]);c.init();a(window).on("resize",function(){if(this.carouselResizeTo){clearTimeout(this.carouselResizeTo)}this.carouselResizeTo=setTimeout(function(){a(this).trigger("carouselResizeEnd")},10)})});a(window).load(function(){c.testPreload();c.config()})})}})(jQuery);